(function(f,d){"function"===typeof define&&define.amd?define("gridster-coords",["jquery"],d):f.GridsterCoords=d(f.$||f.jQuery)})(this,function(f){function d(d){d[0]&&f.isPlainObject(d[0])?this.data=d[0]:this.el=d;this.isCoords=!0;this.coords={};this.init();return this}var q=d.prototype;q.init=function(){this.set();this.original_coords=this.get()};q.set=function(f,d){var a=this.el;a&&!f&&(this.data=a.offset(),this.data.width=a.width(),this.data.height=a.height());if(a&&f&&!d){var b=a.offset();this.data.top=
b.top;this.data.left=b.left}b=this.data;"undefined"===typeof b.left&&(b.left=b.x1);"undefined"===typeof b.top&&(b.top=b.y1);this.coords.x1=b.left;this.coords.y1=b.top;this.coords.x2=b.left+b.width;this.coords.y2=b.top+b.height;this.coords.cx=b.left+b.width/2;this.coords.cy=b.top+b.height/2;this.coords.width=b.width;this.coords.height=b.height;this.coords.el=a||!1;return this};q.update=function(d){if(!d&&!this.el)return this;if(d)return this.data=f.extend({},this.data,d),this.set(!0,!0);this.set(!0);
return this};q.get=function(){return this.coords};q.destroy=function(){this.el.removeData("coords");delete this.el};f.fn.coords=function(f){if(this.data("coords"))return this.data("coords");f=new d(this,f);this.data("coords",f);return f};return d});
(function(f,d){"function"===typeof define&&define.amd?define("gridster-collision",["jquery","gridster-coords"],d):f.GridsterCollision=d(f.$||f.jQuery,f.GridsterCoords)})(this,function(f,d){function q(a,b,c){this.options=f.extend(l,c);this.$element=a;this.last_colliders=[];this.last_colliders_coords=[];this.set_colliders(b);this.init()}var l={colliders_context:document.body,overlapping_region:"C"};q.defaults=l;var p=q.prototype;p.init=function(){this.find_collisions()};p.overlaps=function(a,b){var c=
!1,e=!1;if(b.x1>=a.x1&&b.x1<=a.x2||b.x2>=a.x1&&b.x2<=a.x2||a.x1>=b.x1&&a.x2<=b.x2)c=!0;if(b.y1>=a.y1&&b.y1<=a.y2||b.y2>=a.y1&&b.y2<=a.y2||a.y1>=b.y1&&a.y2<=b.y2)e=!0;return c&&e};p.detect_overlapping_region=function(a,b){var c="",e="";a.y1>b.cy&&a.y1<b.y2&&(c="N");a.y2>b.y1&&a.y2<b.cy&&(c="S");a.x1>b.cx&&a.x1<b.x2&&(e="W");a.x2>b.x1&&a.x2<b.cx&&(e="E");return c+e||"C"};p.calculate_overlapped_area_coords=function(a,b){var c=Math.max(a.x1,b.x1),e=Math.max(a.y1,b.y1),r=Math.min(a.x2,b.x2),g=Math.min(a.y2,
b.y2);return f({left:c,top:e,width:r-c,height:g-e}).coords().get()};p.calculate_overlapped_area=function(a){return a.width*a.height};p.manage_colliders_start_stop=function(a,b,c){for(var e=this.last_colliders_coords,r=0,g=e.length;r<g;r++)-1===f.inArray(e[r],a)&&b.call(this,e[r]);b=0;for(r=a.length;b<r;b++)-1===f.inArray(a[b],e)&&c.call(this,a[b])};p.find_collisions=function(a){var b=this.options.overlapping_region,c=[],e=[],r=this.colliders||this.$colliders,g=r.length;for(a=this.$element.coords().update(a||
!1).get();g--;){var d=this.$colliders?f(r[g]):r[g],k=d.isCoords?d:d.coords(),m=k.get();if(this.overlaps(a,m)){var n=this.detect_overlapping_region(a,m);if(n===b||"all"===b){var l=this.calculate_overlapped_area_coords(a,m),d={area:this.calculate_overlapped_area(l),area_coords:l,region:n,coords:m,player_coords:a,el:d};this.options.on_overlap&&this.options.on_overlap.call(this,d);c.push(k);e.push(d)}}}(this.options.on_overlap_stop||this.options.on_overlap_start)&&this.manage_colliders_start_stop(c,this.options.on_overlap_start,
this.options.on_overlap_stop);this.last_colliders_coords=c;return e};p.get_closest_colliders=function(a){a=this.find_collisions(a);a.sort(function(a,c){return"C"===a.region&&"C"===c.region?a.coords.y1<c.coords.y1||a.coords.x1<c.coords.x1?-1:1:1});return a};p.set_colliders=function(a){"string"===typeof a||a instanceof f?this.$colliders=f(a,this.options.colliders_context).not(this.$element):this.colliders=f(a)};f.fn.collision=function(a,b){return new q(this,a,b)};return q});
(function(f,d){f.delay=function(f,d){var p=Array.prototype.slice.call(arguments,2);return setTimeout(function(){return f.apply(null,p)},d)};f.debounce=function(f,d,p){var a;return function(){var b=this,c=arguments;p&&!a&&f.apply(b,c);clearTimeout(a);a=setTimeout(function(){a=null;p||f.apply(b,c)},d)}};f.throttle=function(f,d){var p,a,b,c,e,r,g=debounce(function(){e=c=!1},d);return function(){p=this;a=arguments;b||(b=setTimeout(function(){b=null;e&&f.apply(p,a);g()},d));c?e=!0:r=f.apply(p,a);g();c=
!0;return r}}})(window);
(function(f,d){"function"===typeof define&&define.amd?define("gridster-draggable",["jquery"],d):f.GridsterDraggable=d(f.$||f.jQuery)})(this,function(f){function d(a,b){this.options=f.extend({},q,b);this.$document=f(document);this.$container=f(a);this.$dragitems=f(this.options.items,this.$container);this.is_dragging=!1;this.player_min_left=0+this.options.offset_left;this.id=++c+"";this.ns=".gridster-draggable-"+this.id;this.init()}var q={items:"li",distance:1,limit:!0,offset_left:0,autoscroll:!0,ignore_dragging:["INPUT",
"TEXTAREA","SELECT","BUTTON"],handle:null,container_width:0,move_element:!0,helper:!1,remove_helper:!0},l=f(window),p={x:"left",y:"top"},a=!!("ontouchstart"in window),b=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},c=0;d.defaults=q;var e=d.prototype;e.init=function(){var a=this.$container.css("position");this.calculate_dimensions();this.$container.css("position","static"===a?"relative":a);this.disabled=!1;this.events();f(window).bind(this.nsEvent("resize"),throttle(f.proxy(this.calculate_dimensions,
this),200))};e.nsEvent=function(a){return(a||"")+this.ns};e.events=function(){this.pointer_events={start:this.nsEvent("touchstart")+" "+this.nsEvent("mousedown"),move:this.nsEvent("touchmove")+" "+this.nsEvent("mousemove"),end:this.nsEvent("touchend")+" "+this.nsEvent("mouseup")};this.$container.on(this.nsEvent("selectstart"),f.proxy(this.on_select_start,this));this.$container.on(this.pointer_events.start,this.options.items,f.proxy(this.drag_handler,this));this.$document.on(this.pointer_events.end,
f.proxy(function(a){this.is_dragging=!1;if(!this.disabled&&(this.$document.off(this.pointer_events.move),this.drag_start))this.on_dragstop(a)},this))};e.get_actual_pos=function(a){return a.position()};e.get_mouse_pos=function(a){a.originalEvent&&a.originalEvent.touches&&(a=a.originalEvent,a=a.touches.length?a.touches[0]:a.changedTouches[0]);return{left:a.clientX,top:a.clientY}};e.get_offset=function(a){a.preventDefault();a=this.get_mouse_pos(a);var b=Math.round(a.left-this.mouse_init_pos.left),c=
Math.round(a.top-this.mouse_init_pos.top),e=Math.round(this.el_init_offset.left+b-this.baseX+f(window).scrollLeft()-this.win_offset_x),d=Math.round(this.el_init_offset.top+c-this.baseY+f(window).scrollTop()-this.win_offset_y);this.options.limit&&(e>this.player_max_left?e=this.player_max_left:e<this.player_min_left&&(e=this.player_min_left));return{position:{left:e,top:d},pointer:{left:a.left,top:a.top,diff_left:b+(f(window).scrollLeft()-this.win_offset_x),diff_top:c+(f(window).scrollTop()-this.win_offset_y)}}};
e.get_drag_data=function(a){a=this.get_offset(a);a.$player=this.$player;a.$helper=this.helper?this.$helper:this.$player;return a};e.set_limits=function(a){a||(a=this.$container.width());this.player_max_left=a-this.player_width+-this.options.offset_left;this.options.container_width=a;return this};e.scroll_in=function(a,c){var e=p[a],d="x"===a,m=d?this.window_width:this.window_height,n=d?f(document).width():f(document).height(),q=d?this.$player.width():this.$player.height(),d=l["scroll"+b(e)](),y=d+
50,x=d+c.pointer[e],n=n-m+q;x>=d+m-50&&(m=d+30,m<n&&(l["scroll"+b(e)](m),this["scroll_offset_"+a]+=30));x<=y&&(m=d-30,0<m&&(l["scroll"+b(e)](m),this["scroll_offset_"+a]-=30));return this};e.manage_scroll=function(a){this.scroll_in("x",a);this.scroll_in("y",a)};e.calculate_dimensions=function(a){this.window_height=l.height();this.window_width=l.width()};e.drag_handler=function(b){if(!this.disabled&&(1===b.which||a)&&!this.ignore_drag(b)){var c=this,e=!0;this.$player=f(b.currentTarget);this.el_init_pos=
this.get_actual_pos(this.$player);this.mouse_init_pos=this.get_mouse_pos(b);this.offsetY=this.mouse_init_pos.top-this.el_init_pos.top;this.$document.on(this.pointer_events.move,function(a){var b=c.get_mouse_pos(a),f=Math.abs(b.left-c.mouse_init_pos.left),b=Math.abs(b.top-c.mouse_init_pos.top);if(!(f>c.options.distance||b>c.options.distance))return!1;if(e)return e=!1,c.on_dragstart.call(c,a),!1;!0===c.is_dragging&&c.on_dragmove.call(c,a);return!1});if(!a)return!1}};e.on_dragstart=function(a){a.preventDefault();
if(this.is_dragging)return this;this.drag_start=this.is_dragging=!0;var b=this.$container.offset();this.baseX=Math.round(b.left);this.baseY=Math.round(b.top);this.initial_container_width=this.options.container_width||this.$container.width();"clone"===this.options.helper?(this.$helper=this.$player.clone().appendTo(this.$container).addClass("helper"),this.helper=!0):this.helper=!1;this.win_offset_y=f(window).scrollTop();this.win_offset_x=f(window).scrollLeft();this.scroll_offset_x=this.scroll_offset_y=
0;this.el_init_offset=this.$player.offset();this.player_width=this.$player.width();this.player_height=this.$player.height();this.set_limits(this.options.container_width);this.options.start&&this.options.start.call(this.$player,a,this.get_drag_data(a));return!1};e.on_dragmove=function(a){var b=this.get_drag_data(a);this.options.autoscroll&&this.manage_scroll(b);this.options.move_element&&(this.helper?this.$helper:this.$player).css({position:"absolute",left:b.position.left,top:b.position.top});b.prev_position=
this.last_position||b.position;this.options.drag&&this.options.drag.call(this.$player,a,b);this.last_position=b.position;return!1};e.on_dragstop=function(a){var b=this.get_drag_data(a);this.drag_start=!1;this.options.stop&&this.options.stop.call(this.$player,a,b);this.helper&&this.options.remove_helper&&this.$helper.remove();return!1};e.on_select_start=function(a){if(!this.disabled&&!this.ignore_drag(a))return!1};e.enable=function(){this.disabled=!1};e.disable=function(){this.disabled=!0};e.destroy=
function(){this.disable();this.$container.off(this.ns);this.$document.off(this.ns);f(window).off(this.ns);f.removeData(this.$container,"drag")};e.ignore_drag=function(a){return this.options.handle?!f(a.target).is(this.options.handle):f.isFunction(this.options.ignore_dragging)?this.options.ignore_dragging(a):f(a.target).is(this.options.ignore_dragging.join(", "))};f.fn.drag=function(a){return new d(this,a)};return d});
(function(f,d){"function"===typeof define&&define.amd?define(["jquery","gridster-draggable","gridster-collision"],d):f.Gridster=d(f.$||f.jQuery,f.GridsterDraggable,f.GridsterCollision)})(this,function(f,d,q){function l(a,b){this.options=f.extend(!0,{},p,b);this.$el=f(a);this.$wrapper=this.$el.parent();this.$widgets=this.$el.children(this.options.widget_selector).addClass("gs-w");this.widgets=[];this.$changed=f([]);this.wrapper_width=this.$wrapper.width();this.min_widget_width=2*this.options.widget_margins[0]+
this.options.widget_base_dimensions[0];this.min_widget_height=2*this.options.widget_margins[1]+this.options.widget_base_dimensions[1];this.generated_stylesheets=[];this.$style_tags=f([]);this.options.auto_init&&this.init()}var p={namespace:"",widget_selector:"li",widget_margins:[10,10],widget_base_dimensions:[400,225],extra_rows:0,extra_cols:0,min_cols:1,max_cols:Infinity,min_rows:15,max_size_x:!1,autogrow_cols:!1,autogenerate_stylesheet:!0,avoid_overlapped_widgets:!0,auto_init:!0,serialize_params:function(a,
b){return{col:b.col,row:b.row,size_x:b.size_x,size_y:b.size_y}},collision:{},draggable:{items:".gs-w",distance:4,ignore_dragging:d.defaults.ignore_dragging.slice(0)},resize:{enabled:!1,axes:["both"],handle_append_to:"",handle_class:"gs-resize-handle",max_size:[Infinity,Infinity],min_size:[1,1]}};l.defaults=p;l.generated_stylesheets=[];l.sort_by_row_asc=function(a){return a=a.sort(function(a,c){a.row||(a=f(a).coords().grid,c=f(c).coords().grid);return a.row>c.row?1:-1})};l.sort_by_row_and_col_asc=
function(a){return a=a.sort(function(a,c){return a.row>c.row||a.row===c.row&&a.col>c.col?1:-1})};l.sort_by_col_asc=function(a){return a=a.sort(function(a,c){return a.col>c.col?1:-1})};l.sort_by_row_desc=function(a){return a=a.sort(function(a,c){return a.row+a.size_y<c.row+c.size_y?1:-1})};d=l.prototype;d.init=function(){this.options.resize.enabled&&this.setup_resize();this.generate_grid_and_stylesheet();this.get_widgets_from_DOM();this.set_dom_grid_height();this.set_dom_grid_width();this.$wrapper.addClass("ready");
this.draggable();this.options.resize.enabled&&this.resizable();f(window).bind("resize.gridster",throttle(f.proxy(this.recalculate_faux_grid,this),200))};d.disable=function(){this.$wrapper.find(".player-revert").removeClass("player-revert");this.drag_api.disable();return this};d.enable=function(){this.drag_api.enable();return this};d.disable_resize=function(){this.$el.addClass("gs-resize-disabled");this.resize_api.disable();return this};d.enable_resize=function(){this.$el.removeClass("gs-resize-disabled");
this.resize_api.enable();return this};d.add_widget=function(a,b,c,e,d,g,h){var k;b||(b=1);c||(c=1);!e&!d?k=this.next_position(b,c):(k={col:e,row:d,size_x:b,size_y:c},this.empty_cells(e,d,b,c));a=f(a).attr({"data-col":k.col,"data-row":k.row,"data-sizex":b,"data-sizey":c}).addClass("gs-w").appendTo(this.$el).hide();this.$widgets=this.$widgets.add(a);this.register_widget(a);this.add_faux_rows(k.size_y);g&&this.set_widget_max_size(a,g);h&&this.set_widget_min_size(a,h);this.set_dom_grid_width();this.set_dom_grid_height();
this.drag_api.set_limits(this.cols*this.min_widget_width);return a.fadeIn()};d.set_widget_min_size=function(a,b){a="number"===typeof a?this.$widgets.eq(a):a;if(!a.length)return this;var c=a.data("coords").grid;c.min_size_x=b[0];c.min_size_y=b[1];return this};d.set_widget_max_size=function(a,b){a="number"===typeof a?this.$widgets.eq(a):a;if(!a.length)return this;var c=a.data("coords").grid;c.max_size_x=b[0];c.max_size_y=b[1];return this};d.add_resize_handle=function(a){var b=this.options.resize.handle_append_to;
f(this.resize_handle_tpl).appendTo(b?f(b,a):a);return this};d.resize_widget=function(a,b,c,e){var f=a.coords().grid,d=f.col,h=this.options.max_cols,k=f.size_y,m=f.col;b||(b=f.size_x);c||(c=f.size_y);Infinity!==h&&(b=Math.min(b,h-d+1));c>k&&this.add_faux_rows(Math.max(c-k,0));d=d+b-1;d>this.cols&&this.add_faux_cols(d-this.cols);b={col:m,row:f.row,size_x:b,size_y:c};this.mutate_widget_in_gridmap(a,f,b);this.set_dom_grid_height();this.set_dom_grid_width();e&&e.call(this,b.size_x,b.size_y);return a};
d.mutate_widget_in_gridmap=function(a,b,c){var e=b.size_y,d=this.get_cells_occupied(b),g=this.get_cells_occupied(c),h=[];f.each(d.cols,function(a,b){-1===f.inArray(b,g.cols)&&h.push(b)});var k=[];f.each(g.cols,function(a,b){-1===f.inArray(b,d.cols)&&k.push(b)});var m=[];f.each(d.rows,function(a,b){-1===f.inArray(b,g.rows)&&m.push(b)});var n=[];f.each(g.rows,function(a,b){-1===f.inArray(b,d.rows)&&n.push(b)});this.remove_from_gridmap(b);if(k.length){var l=[c.col,c.row,c.size_x,Math.min(e,c.size_y),
a];this.empty_cells.apply(this,l)}n.length&&this.empty_cells.apply(this,[c.col,c.row,c.size_x,c.size_y,a]);b.col=c.col;b.row=c.row;b.size_x=c.size_x;b.size_y=c.size_y;this.add_to_gridmap(c,a);a.removeClass("player-revert");a.data("coords").update({width:c.size_x*this.options.widget_base_dimensions[0]+(c.size_x-1)*this.options.widget_margins[0]*2,height:c.size_y*this.options.widget_base_dimensions[1]+(c.size_y-1)*this.options.widget_margins[1]*2});a.attr({"data-col":c.col,"data-row":c.row,"data-sizex":c.size_x,
"data-sizey":c.size_y});h.length&&(b=[h[0],c.row,h.length,Math.min(e,c.size_y),a],this.remove_empty_cells.apply(this,b));m.length&&this.remove_empty_cells.apply(this,[c.col,c.row,c.size_x,c.size_y,a]);this.move_widget_up(a);return this};d.empty_cells=function(a,b,c,e,d){this.widgets_below({col:a,row:b-e,size_x:c,size_y:e}).not(d).each(f.proxy(function(a,c){var d=f(c).coords().grid;d.row<=b+e-1&&(d=b+e-d.row,this.move_widget_down(f(c),d))},this));this.set_dom_grid_height();return this};d.remove_empty_cells=
function(a,b,c,e,d){this.widgets_below({col:a,row:b,size_x:c,size_y:e}).not(d).each(f.proxy(function(a,b){this.move_widget_up(f(b),e)},this));this.set_dom_grid_height();return this};d.next_position=function(a,b){a||(a=1);b||(b=1);for(var c=this.gridmap,e=c.length,f=[],d,h=1;h<e;h++){d=c[h].length;for(var k=1;k<=d;k++)this.can_move_to({size_x:a,size_y:b},h,k)&&f.push({col:h,row:k,size_y:b,size_x:a})}return f.length?l.sort_by_row_and_col_asc(f)[0]:!1};d.remove_widget=function(a,b,c){var e=a instanceof
f?a:f(a),d=e.coords().grid;f.isFunction(b)&&(c=b,b=!1);this.cells_occupied_by_placeholder={};this.$widgets=this.$widgets.not(e);var g=this.widgets_below(e);this.remove_from_gridmap(d);e.fadeOut(f.proxy(function(){e.remove();b||g.each(f.proxy(function(a,b){this.move_widget_up(f(b),d.size_y)},this));this.set_dom_grid_height();c&&c.call(this,a)},this));return this};d.remove_all_widgets=function(a){this.$widgets.each(f.proxy(function(b,c){this.remove_widget(c,!0,a)},this));return this};d.serialize=function(a){a||
(a=this.$widgets);return a.map(f.proxy(function(a,c){var e=f(c);return this.options.serialize_params(e,e.coords().grid)},this)).get()};d.serialize_changed=function(){return this.serialize(this.$changed)};d.dom_to_coords=function(a){return{col:parseInt(a.attr("data-col"),10),row:parseInt(a.attr("data-row"),10),size_x:parseInt(a.attr("data-sizex"),10)||1,size_y:parseInt(a.attr("data-sizey"),10)||1,max_size_x:parseInt(a.attr("data-max-sizex"),10)||!1,max_size_y:parseInt(a.attr("data-max-sizey"),10)||
!1,min_size_x:parseInt(a.attr("data-min-sizex"),10)||!1,min_size_y:parseInt(a.attr("data-min-sizey"),10)||!1,el:a}};d.register_widget=function(a){var b=a instanceof jQuery,c=b?this.dom_to_coords(a):a,e=!1;b||(a=c.el);if(b=this.can_go_widget_up(c))c.row=b,a.attr("data-row",b),this.$el.trigger("gridster:positionchanged",[c]),e=!0;this.options.avoid_overlapped_widgets&&!this.can_move_to({size_x:c.size_x,size_y:c.size_y},c.col,c.row)&&(f.extend(c,this.next_position(c.size_x,c.size_y)),a.attr({"data-col":c.col,
"data-row":c.row,"data-sizex":c.size_x,"data-sizey":c.size_y}),e=!0);a.data("coords",a.coords());a.data("coords").grid=c;this.add_to_gridmap(c,a);this.options.resize.enabled&&this.add_resize_handle(a);return e};d.update_widget_position=function(a,b){this.for_each_cell_occupied(a,function(a,e){if(!this.gridmap[a])return this;this.gridmap[a][e]=b});return this};d.remove_from_gridmap=function(a){return this.update_widget_position(a,!1)};d.add_to_gridmap=function(a,b){this.update_widget_position(a,b||
a.el);a.el&&this.widgets_below(a.el).each(f.proxy(function(a,b){this.move_widget_up(f(b))},this))};d.draggable=function(){var a=this,b=f.extend(!0,{},this.options.draggable,{offset_left:this.options.widget_margins[0],offset_top:this.options.widget_margins[1],container_width:this.cols*this.min_widget_width,limit:!0,start:function(b,e){a.$widgets.filter(".player-revert").removeClass("player-revert");a.$player=f(this);a.$helper=f(e.$helper);a.helper=!a.$helper.is(a.$player);a.on_start_drag.call(a,b,
e);a.$el.trigger("gridster:dragstart")},stop:function(b,e){a.on_stop_drag.call(a,b,e);a.$el.trigger("gridster:dragstop")},drag:throttle(function(b,e){a.on_drag.call(a,b,e);a.$el.trigger("gridster:drag")},60)});this.drag_api=this.$el.drag(b);return this};d.resizable=function(){this.resize_api=this.$el.drag({items:"."+this.options.resize.handle_class,offset_left:this.options.widget_margins[0],container_width:this.container_width,move_element:!1,resize:!0,limit:this.options.autogrow_cols?!1:!0,start:f.proxy(this.on_start_resize,
this),stop:f.proxy(function(a,b){delay(f.proxy(function(){this.on_stop_resize(a,b)},this),120)},this),drag:throttle(f.proxy(this.on_resize,this),60)});return this};d.setup_resize=function(){this.resize_handle_class=this.options.resize.handle_class;var a='<span class="'+this.resize_handle_class+" "+this.resize_handle_class+'-{type}" />';this.resize_handle_tpl=f.map(this.options.resize.axes,function(b){return a.replace("{type}",b)}).join("");f.isArray(this.options.draggable.ignore_dragging)&&this.options.draggable.ignore_dragging.push("."+
this.resize_handle_class);return this};d.on_start_drag=function(a,b){this.$helper.add(this.$player).add(this.$wrapper).addClass("dragging");this.highest_col=this.get_highest_occupied_cell().col;this.$player.addClass("player");this.player_grid_data=this.$player.coords().grid;this.placeholder_grid_data=f.extend({},this.player_grid_data);this.set_dom_grid_height(this.$el.height()+this.player_grid_data.size_y*this.min_widget_height);this.set_dom_grid_width(this.cols);var c=this.player_grid_data.size_x,
e=this.cols-this.highest_col;this.options.autogrow_cols&&e<=c&&this.add_faux_cols(Math.min(c-e,1));c=this.faux_grid;e=this.$player.data("coords").coords;this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data);this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data);this.last_cols=[];this.last_rows=[];this.collision_api=this.$helper.collision(c,this.options.collision);this.$preview_holder=f("<"+this.$player.get(0).tagName+" />",{"class":"preview-holder",
"data-row":this.$player.attr("data-row"),"data-col":this.$player.attr("data-col"),css:{width:e.width,height:e.height}}).appendTo(this.$el);this.options.draggable.start&&this.options.draggable.start.call(this,a,b)};d.on_drag=function(a,b){if(null===this.$player)return!1;var c={left:b.position.left+this.baseX,top:b.position.top+this.baseY};this.options.autogrow_cols&&(this.placeholder_grid_data.col+this.placeholder_grid_data.size_x-1>=this.cols-1&&this.options.max_cols>=this.cols+1&&(this.add_faux_cols(1),
this.set_dom_grid_width(this.cols+1),this.drag_api.set_limits(this.container_width)),this.collision_api.set_colliders(this.faux_grid));this.colliders_data=this.collision_api.get_closest_colliders(c);this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column);this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row);this.helper&&this.$player&&this.$player.css({left:b.position.left,top:b.position.top});this.options.draggable.drag&&
this.options.draggable.drag.call(this,a,b)};d.on_stop_drag=function(a,b){this.$helper.add(this.$player).add(this.$wrapper).removeClass("dragging");b.position.left+=this.baseX;b.position.top+=this.baseY;this.colliders_data=this.collision_api.get_closest_colliders(b.position);this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column);this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row);this.$player.addClass("player-revert").removeClass("player").attr({"data-col":this.placeholder_grid_data.col,
"data-row":this.placeholder_grid_data.row}).css({left:"",top:""});this.$changed=this.$changed.add(this.$player);this.cells_occupied_by_player=this.get_cells_occupied(this.placeholder_grid_data);this.set_cells_player_occupies(this.placeholder_grid_data.col,this.placeholder_grid_data.row);this.$player.coords().grid.row=this.placeholder_grid_data.row;this.$player.coords().grid.col=this.placeholder_grid_data.col;this.options.draggable.stop&&this.options.draggable.stop.call(this,a,b);this.$preview_holder.remove();
this.$helper=this.$player=null;this.placeholder_grid_data={};this.player_grid_data={};this.cells_occupied_by_placeholder={};this.cells_occupied_by_player={};this.set_dom_grid_height();this.set_dom_grid_width();this.options.autogrow_cols&&this.drag_api.set_limits(this.cols*this.min_widget_width)};d.on_start_resize=function(a,b){this.$resized_widget=b.$player.closest(".gs-w");this.resize_coords=this.$resized_widget.coords();this.resize_wgd=this.resize_coords.grid;this.resize_initial_width=this.resize_coords.coords.width;
this.resize_initial_height=this.resize_coords.coords.height;this.resize_initial_sizex=this.resize_coords.grid.size_x;this.resize_initial_sizey=this.resize_coords.grid.size_y;this.resize_initial_col=this.resize_coords.grid.col;this.resize_last_sizex=this.resize_initial_sizex;this.resize_last_sizey=this.resize_initial_sizey;this.resize_max_size_x=Math.min(this.resize_wgd.max_size_x||this.options.resize.max_size[0],this.options.max_cols-this.resize_initial_col+1);this.resize_max_size_y=this.resize_wgd.max_size_y||
this.options.resize.max_size[1];this.resize_min_size_x=this.resize_wgd.min_size_x||this.options.resize.min_size[0]||1;this.resize_min_size_y=this.resize_wgd.min_size_y||this.options.resize.min_size[1]||1;this.resize_initial_last_col=this.get_highest_occupied_cell().col;this.set_dom_grid_width(this.cols);this.resize_dir={right:b.$player.is("."+this.resize_handle_class+"-x"),bottom:b.$player.is("."+this.resize_handle_class+"-y")};this.$resized_widget.css({"min-width":this.options.widget_base_dimensions[0],
"min-height":this.options.widget_base_dimensions[1]});var c=this.$resized_widget.get(0).tagName;this.$resize_preview_holder=f("<"+c+" />",{"class":"preview-holder resize-preview-holder","data-row":this.$resized_widget.attr("data-row"),"data-col":this.$resized_widget.attr("data-col"),css:{width:this.resize_initial_width,height:this.resize_initial_height}}).appendTo(this.$el);this.$resized_widget.addClass("resizing");this.options.resize.start&&this.options.resize.start.call(this,a,b,this.$resized_widget);
this.$el.trigger("gridster:resizestart")};d.on_stop_resize=function(a,b){this.$resized_widget.removeClass("resizing").css({width:"",height:""});delay(f.proxy(function(){this.$resize_preview_holder.remove().css({"min-width":"","min-height":""});this.options.resize.stop&&this.options.resize.stop.call(this,a,b,this.$resized_widget);this.$el.trigger("gridster:resizestop")},this),300);this.set_dom_grid_width();this.options.autogrow_cols&&this.drag_api.set_limits(this.cols*this.min_widget_width)};d.on_resize=
function(a,b){var c=b.pointer.diff_left,e=b.pointer.diff_top,f=this.options.widget_base_dimensions[0],d=this.options.widget_base_dimensions[1],h=this.options.widget_margins[0],k=this.options.widget_margins[1],m=this.resize_max_size_x,n=this.resize_min_size_x,l=this.resize_max_size_y,p=this.resize_min_size_y,q=this.options.autogrow_cols,v=Infinity,w=Infinity,t=Math.ceil(c/(f+2*h)-.2),u=Math.ceil(e/(d+2*k)-.2),t=Math.max(1,this.resize_initial_sizex+t),u=Math.max(1,this.resize_initial_sizey+u),v=this.container_width/
this.min_widget_width-this.resize_initial_col+1,w=v*this.min_widget_width-2*h,t=Math.max(Math.min(t,m),n),t=Math.min(v,t),v=Math.min(m*f+(t-1)*h*2,w);min_width=n*f+(t-1)*h*2;u=Math.max(Math.min(u,l),p);w=l*d+(u-1)*k*2;min_height=p*d+(u-1)*k*2;this.resize_dir.right?u=this.resize_initial_sizey:this.resize_dir.bottom&&(t=this.resize_initial_sizex);q&&(f=this.resize_initial_col+t-1,q&&this.resize_initial_last_col<=f&&(this.set_dom_grid_width(Math.max(f+1,this.cols)),this.cols<f&&this.add_faux_cols(f-
this.cols)));q={};!this.resize_dir.bottom&&(q.width=Math.max(Math.min(this.resize_initial_width+c,v),min_width));!this.resize_dir.right&&(q.height=Math.max(Math.min(this.resize_initial_height+e,w),min_height));this.$resized_widget.css(q);if(t!==this.resize_last_sizex||u!==this.resize_last_sizey)this.resize_widget(this.$resized_widget,t,u),this.set_dom_grid_width(this.cols),this.$resize_preview_holder.css({width:"",height:""}).attr({"data-row":this.$resized_widget.attr("data-row"),"data-sizex":t,"data-sizey":u});
this.options.resize.resize&&this.options.resize.resize.call(this,a,b,this.$resized_widget);this.$el.trigger("gridster:resize");this.resize_last_sizex=t;this.resize_last_sizey=u};d.on_overlapped_column_change=function(a,b){if(!this.colliders_data.length)return this;var c=this.get_targeted_columns(this.colliders_data[0].el.data.col),e=this.last_cols.length,d=c.length,g;for(g=0;g<d;g++)-1===f.inArray(c[g],this.last_cols)&&(a||f.noop).call(this,c[g]);for(g=0;g<e;g++)-1===f.inArray(this.last_cols[g],c)&&
(b||f.noop).call(this,this.last_cols[g]);this.last_cols=c;return this};d.on_overlapped_row_change=function(a,b){if(!this.colliders_data.length)return this;var c=this.get_targeted_rows(this.colliders_data[0].el.data.row),e=this.last_rows.length,d=c.length,g;for(g=0;g<d;g++)-1===f.inArray(c[g],this.last_rows)&&(a||f.noop).call(this,c[g]);for(g=0;g<e;g++)-1===f.inArray(this.last_rows[g],c)&&(b||f.noop).call(this,this.last_rows[g]);this.last_rows=c};d.set_player=function(a,b,c){c||this.empty_cells_player_occupies();
c=c?{col:a}:this.colliders_data[0].el.data;a=c.col;b=b||c.row;this.player_grid_data={col:a,row:b,size_y:this.player_grid_data.size_y,size_x:this.player_grid_data.size_x};this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data);c=this.get_widgets_overlapped(this.player_grid_data);var e=this.widgets_constraints(c);this.manage_movements(e.can_go_up,a,b);this.manage_movements(e.can_not_go_up,a,b);c.length||(c=this.can_go_player_up(this.player_grid_data),!1!==c&&(b=c),this.set_placeholder(a,
b));return{col:a,row:b}};d.widgets_constraints=function(a){var b=f([]),c=[],e=[];a.each(f.proxy(function(a,d){var h=f(d),k=h.coords().grid;this.can_go_widget_up(k)?(b=b.add(h),c.push(k)):e.push(k)},this));a.not(b);return{can_go_up:l.sort_by_row_asc(c),can_not_go_up:l.sort_by_row_desc(e)}};d.manage_movements=function(a,b,c){f.each(a,f.proxy(function(a,f){var d=f.el,h=this.can_go_widget_up(f);h?(this.move_widget_to(d,h),this.set_placeholder(b,h+f.size_y)):this.can_go_player_up(this.player_grid_data)||
(this.move_widget_down(d,c+this.player_grid_data.size_y-f.row),this.set_placeholder(b,c))},this));return this};d.is_player=function(a,b){if(b&&!this.gridmap[a])return!1;var c=b?this.gridmap[a][b]:a;return c&&(c.is(this.$player)||c.is(this.$helper))};d.is_player_in=function(a,b){var c=this.cells_occupied_by_player||{};return 0<=f.inArray(a,c.cols)&&0<=f.inArray(b,c.rows)};d.is_placeholder_in=function(a,b){var c=this.cells_occupied_by_placeholder||{};return this.is_placeholder_in_col(a)&&0<=f.inArray(b,
c.rows)};d.is_placeholder_in_col=function(a){return 0<=f.inArray(a,(this.cells_occupied_by_placeholder||[]).cols)};d.is_empty=function(a,b){return"undefined"!==typeof this.gridmap[a]?"undefined"!==typeof this.gridmap[a][b]&&!1===this.gridmap[a][b]?!0:!1:!0};d.is_occupied=function(a,b){return this.gridmap[a]?this.gridmap[a][b]?!0:!1:!1};d.is_widget=function(a,b){var c=this.gridmap[a];return c?(c=c[b])?c:!1:!1};d.is_widget_under_player=function(a,b){return this.is_widget(a,b)?this.is_player_in(a,b):
!1};d.get_widgets_under_player=function(a){a||(a=this.cells_occupied_by_player||{cols:[],rows:[]});var b=f([]);f.each(a.cols,f.proxy(function(c,e){f.each(a.rows,f.proxy(function(a,c){this.is_widget(e,c)&&(b=b.add(this.gridmap[e][c]))},this))},this));return b};d.set_placeholder=function(a,b){var c=f.extend({},this.placeholder_grid_data),e=this.widgets_below({col:c.col,row:c.row,size_y:c.size_y,size_x:c.size_x}),d=a+c.size_x-1;d>this.cols&&(a-=d-a);var d=this.placeholder_grid_data.row<b,g=this.placeholder_grid_data.col!==
a;this.placeholder_grid_data.col=a;this.placeholder_grid_data.row=b;this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data);this.$preview_holder.attr({"data-row":b,"data-col":a});(d||g)&&e.each(f.proxy(function(b,e){this.move_widget_up(f(e),this.placeholder_grid_data.col-a+c.size_y)},this));e=this.get_widgets_under_player(this.cells_occupied_by_placeholder);e.length&&e.each(f.proxy(function(a,e){var d=f(e);this.move_widget_down(d,b+c.size_y-d.data("coords").grid.row)},
this))};d.can_go_player_up=function(a){var b=a.row+a.size_y-1,c=!0,e=[],f=1E4,d=this.get_widgets_under_player();this.for_each_column_occupied(a,function(a){var k=this.gridmap[a],m=b+1;for(e[a]=[];0<--m;)if(this.is_empty(a,m)||this.is_player(a,m)||this.is_widget(a,m)&&k[m].is(d))e[a].push(m),f=m<f?m:f;else break;if(0===e[a].length)return c=!1,!0;e[a].sort(function(a,b){return a-b})});return c?this.get_valid_rows(a,e,f):!1};d.can_go_widget_up=function(a){var b=a.row+a.size_y-1,c=!0,e=[],f=1E4;this.for_each_column_occupied(a,
function(d){var h=this.gridmap[d];e[d]=[];for(var k=b+1;0<--k&&(!this.is_widget(d,k)||this.is_player_in(d,k)||h[k].is(a.el));)this.is_player(d,k)||this.is_placeholder_in(d,k)||this.is_player_in(d,k)||e[d].push(k),k<f&&(f=k);if(0===e[d].length)return c=!1,!0;e[d].sort(function(a,b){return a-b})});return c?this.get_valid_rows(a,e,f):!1};d.get_valid_rows=function(a,b,c){var e=a.row,d=a.row+a.size_y-1;a=a.size_y;var g=c-1;for(c=[];++g<=d;){var h=!0;f.each(b,function(a,b){f.isArray(b)&&-1===f.inArray(g,
b)&&(h=!1)});if(!0===h&&(c.push(g),c.length===a))break}b=!1;1===a?c[0]!==e&&(b=c[0]||!1):c[0]!==e&&(b=this.get_consecutive_numbers_index(c,a));return b};d.get_consecutive_numbers_index=function(a,b){for(var c=a.length,e=[],f=!0,d=-1,h=0;h<c;h++){if(f||a[h]===d+1){e.push(h);if(e.length===b)break;f=!1}else e=[],f=!0;d=a[h]}return e.length>=b?a[e[0]]:!1};d.get_widgets_overlapped=function(){var a=f([]),b=[],c=this.cells_occupied_by_player.rows.slice(0);c.reverse();f.each(this.cells_occupied_by_player.cols,
f.proxy(function(e,d){f.each(c,f.proxy(function(c,e){if(!this.gridmap[d])return!0;var k=this.gridmap[d][e];this.is_occupied(d,e)&&!this.is_player(k)&&-1===f.inArray(k,b)&&(a=a.add(k),b.push(k))},this))},this));return a};d.on_start_overlapping_column=function(a){this.set_player(a,!1)};d.on_start_overlapping_row=function(a){this.set_player(!1,a)};d.on_stop_overlapping_column=function(a){this.set_player(a,!1);var b=this;this.for_each_widget_below(a,this.cells_occupied_by_player.rows[0],function(a,e){b.move_widget_up(this,
b.player_grid_data.size_y)})};d.on_stop_overlapping_row=function(a){this.set_player(!1,a);for(var b=this,c=this.cells_occupied_by_player.cols,e=0,f=c.length;e<f;e++)this.for_each_widget_below(c[e],a,function(a,c){b.move_widget_up(this,b.player_grid_data.size_y)})};d.move_widget_to=function(a,b){var c=this,e=a.coords().grid,d=this.widgets_below(a);if(!1===this.can_move_to(e,e.col,b,a))return!1;this.remove_from_gridmap(e);e.row=b;this.add_to_gridmap(e);a.attr("data-row",b);this.$changed=this.$changed.add(a);
d.each(function(a,b){var e=f(b),d=e.coords().grid,r=c.can_go_widget_up(d);r&&r!==d.row&&c.move_widget_to(e,r)});return this};d.move_widget_up=function(a,b){var c=a.coords().grid,e=c.row,d=[];b||(b=1);if(!this.can_go_up(a))return!1;this.for_each_column_occupied(c,function(c){if(-1===f.inArray(a,d)){var h=a.coords().grid,k=e-b,k=this.can_go_up_to_row(h,c,k);if(!k)return!0;c=this.widgets_below(a);this.remove_from_gridmap(h);h.row=k;this.add_to_gridmap(h);a.attr("data-row",h.row);this.$changed=this.$changed.add(a);
d.push(a);c.each(f.proxy(function(a,c){this.move_widget_up(f(c),b)},this))}})};d.move_widget_down=function(a,b){var c,e;if(0>=b)return!1;c=a.coords().grid.row;e=[];if(!a)return!1;if(-1===f.inArray(a,e)){var d=a.coords().grid;c+=b;var g=this.widgets_below(a);this.remove_from_gridmap(d);g.each(f.proxy(function(a,c){var e=f(c),g=e.coords().grid,g=this.displacement_diff(g,d,b);0<g&&this.move_widget_down(e,g)},this));d.row=c;this.update_widget_position(d,a);a.attr("data-row",d.row);this.$changed=this.$changed.add(a);
e.push(a)}};d.can_go_up_to_row=function(a,b,c){var e=!0,d=[],g=a.row,h;this.for_each_column_occupied(a,function(a){d[a]=[];for(h=g;h--;)if(this.is_empty(a,h)&&!this.is_placeholder_in(a,h))d[a].push(h);else break;if(!d[a].length)return e=!1,!0});if(!e)return!1;h=c;for(h=1;h<g;h++){a=!0;b=0;for(c=d.length;b<c;b++)d[b]&&-1===f.inArray(h,d[b])&&(a=!1);if(!0===a){e=h;break}}return e};d.displacement_diff=function(a,b,c){var e=a.row,d=[],f=b.row+b.size_y;this.for_each_column_occupied(a,function(a){for(var b=
0,c=f;c<e;c++)this.is_empty(a,c)&&(b+=1);d.push(b)});a=Math.max.apply(Math,d);c-=a;return 0<c?c:0};d.widgets_below=function(a){a=f.isPlainObject(a)?a:a.coords().grid;var b=this,c=a.row+a.size_y-1,e=f([]);this.for_each_column_occupied(a,function(a){b.for_each_widget_below(a,c,function(a,c){if(!b.is_player(this)&&-1===f.inArray(this,e))return e=e.add(this),!0})});return l.sort_by_row_asc(e)};d.set_cells_player_occupies=function(a,b){this.remove_from_gridmap(this.placeholder_grid_data);this.placeholder_grid_data.col=
a;this.placeholder_grid_data.row=b;this.add_to_gridmap(this.placeholder_grid_data,this.$player);return this};d.empty_cells_player_occupies=function(){this.remove_from_gridmap(this.placeholder_grid_data);return this};d.can_go_up=function(a){a=a.coords().grid;var b=a.row,c=b-1,e=!0;if(1===b)return!1;this.for_each_column_occupied(a,function(a){this.is_widget(a,c);if(this.is_occupied(a,c)||this.is_player(a,c)||this.is_placeholder_in(a,c)||this.is_player_in(a,c))return e=!1,!0});return e};d.can_move_to=
function(a,b,c,e){var d=a.el,f=!0;if(b+a.size_x-1>this.cols||e&&e<c+a.size_y-1)return!1;this.for_each_cell_occupied({size_y:a.size_y,size_x:a.size_x,col:b,row:c},function(b,c){var e=this.is_widget(b,c);!e||a.el&&!e.is(d)||(f=!1)});return f};d.get_targeted_columns=function(a){for(var b=(a||this.player_grid_data.col)+(this.player_grid_data.size_x-1),c=[];a<=b;a++)c.push(a);return c};d.get_targeted_rows=function(a){for(var b=(a||this.player_grid_data.row)+(this.player_grid_data.size_y-1),c=[];a<=b;a++)c.push(a);
return c};d.get_cells_occupied=function(a,b){var c={cols:[],rows:[]},e;b instanceof f&&(a=b.coords().grid);for(e=0;e<a.size_x;e++)c.cols.push(a.col+e);for(e=0;e<a.size_y;e++)c.rows.push(a.row+e);return c};d.for_each_cell_occupied=function(a,b){this.for_each_column_occupied(a,function(c){this.for_each_row_occupied(a,function(a){b.call(this,c,a)})});return this};d.for_each_column_occupied=function(a,b){for(var c=0;c<a.size_x;c++)b.call(this,a.col+c,a)};d.for_each_row_occupied=function(a,b){for(var c=
0;c<a.size_y;c++)b.call(this,a.row+c,a)};d._traversing_widgets=function(a,b,c,e,d){var g=this.gridmap;if(g[c]){var h,k;a=a+"/"+b;c instanceof f&&(b=c.coords().grid,c=b.col,d=e=b.row);var l=[],n=e;b={"for_each/above":function(){for(;n--&&!(0<n&&this.is_widget(c,n)&&-1===f.inArray(g[c][n],l)&&(h=d.call(g[c][n],c,n),l.push(g[c][n]),h)););},"for_each/below":function(){n=e+1;for(k=g[c].length;n<k&&(!this.is_widget(c,n)||-1!==f.inArray(g[c][n],l)||(h=d.call(g[c][n],c,n),l.push(g[c][n]),!h));n++);}};b[a]&&
b[a].call(this)}};d.for_each_widget_above=function(a,b,c){this._traversing_widgets("for_each","above",a,b,c);return this};d.for_each_widget_below=function(a,b,c){this._traversing_widgets("for_each","below",a,b,c);return this};d.get_highest_occupied_cell=function(){var a;a=this.gridmap;for(var b=a[1].length,c=[],e=[],d=a.length-1;1<=d;d--)for(a=b-1;1<=a;a--)if(this.is_widget(d,a)){c.push(a);e.push(d);break}return{col:Math.max.apply(Math,e),row:Math.max.apply(Math,c)}};d.get_widgets_from=function(a,
b){var c=f();a&&(c=c.add(this.$widgets.filter(function(){var b=f(this).attr("data-col");return b===a||b>a})));b&&(c=c.add(this.$widgets.filter(function(){var a=f(this).attr("data-row");return a===b||a>b})));return c};d.set_dom_grid_height=function(a){"undefined"===typeof a&&(a=this.get_highest_occupied_cell().row*this.min_widget_height);this.container_height=a;this.$el.css("height",this.container_height);return this};d.set_dom_grid_width=function(a){"undefined"===typeof a&&(a=this.get_highest_occupied_cell().col);
a=Math.min(this.options.autogrow_cols?this.options.max_cols:this.cols,Math.max(a,this.options.min_cols));this.container_width=a*this.min_widget_width;this.$el.css("width",this.container_width);return this};d.generate_stylesheet=function(a){var b="",c=this.options.max_size_x||this.cols,e;a||(a={});a.cols||(a.cols=this.cols);a.rows||(a.rows=this.rows);a.namespace||(a.namespace=this.options.namespace);a.widget_base_dimensions||(a.widget_base_dimensions=this.options.widget_base_dimensions);a.widget_margins||
(a.widget_margins=this.options.widget_margins);a.min_widget_width=2*a.widget_margins[0]+a.widget_base_dimensions[0];a.min_widget_height=2*a.widget_margins[1]+a.widget_base_dimensions[1];e=f.param(a);if(0<=f.inArray(e,l.generated_stylesheets))return!1;this.generated_stylesheets.push(e);l.generated_stylesheets.push(e);for(e=a.cols;0<=e;e--)b+=a.namespace+' [data-col="'+(e+1)+'"] { left:'+(e*a.widget_base_dimensions[0]+e*a.widget_margins[0]+(e+1)*a.widget_margins[0])+"px; }\n";for(e=a.rows;0<=e;e--)b+=
a.namespace+' [data-row="'+(e+1)+'"] { top:'+(e*a.widget_base_dimensions[1]+e*a.widget_margins[1]+(e+1)*a.widget_margins[1])+"px; }\n";for(e=1;e<=a.rows;e++)b+=a.namespace+' [data-sizey="'+e+'"] { height:'+(e*a.widget_base_dimensions[1]+2*(e-1)*a.widget_margins[1])+"px; }\n";for(e=1;e<=c;e++)b+=a.namespace+' [data-sizex="'+e+'"] { width:'+(e*a.widget_base_dimensions[0]+2*(e-1)*a.widget_margins[0])+"px; }\n";this.remove_style_tags();return this.add_style_tag(b)};d.add_style_tag=function(a){var b=document,
c=b.createElement("style");b.getElementsByTagName("head")[0].appendChild(c);c.setAttribute("type","text/css");c.styleSheet?c.styleSheet.cssText=a:c.appendChild(document.createTextNode(a));this.$style_tags=this.$style_tags.add(c);return this};d.remove_style_tags=function(){var a=l.generated_stylesheets,b=this.generated_stylesheets;this.$style_tags.remove();l.generated_stylesheets=f.map(a,function(a){if(-1===f.inArray(a,b))return a})};d.generate_faux_grid=function(a,b){this.faux_grid=[];this.gridmap=
[];var c,e;for(c=b;0<c;c--)for(this.gridmap[c]=[],e=a;0<e;e--)this.add_faux_cell(e,c);return this};d.add_faux_cell=function(a,b){var c=f({left:this.baseX+(b-1)*this.min_widget_width,top:this.baseY+(a-1)*this.min_widget_height,width:this.min_widget_width,height:this.min_widget_height,col:b,row:a,original_col:b,original_row:a}).coords();f.isArray(this.gridmap[b])||(this.gridmap[b]=[]);this.gridmap[b][a]=!1;this.faux_grid.push(c);return this};d.add_faux_rows=function(a){for(var b=this.rows,c=a=b+(a||
1);c>b;c--)for(var e=this.cols;1<=e;e--)this.add_faux_cell(c,e);this.rows=a;this.options.autogenerate_stylesheet&&this.generate_stylesheet();return this};d.add_faux_cols=function(a){var b=this.cols;a=Math.min(b+(a||1),this.options.max_cols);for(b+=1;b<=a;b++)for(var c=this.rows;1<=c;c--)this.add_faux_cell(c,b);this.cols=a;this.options.autogenerate_stylesheet&&this.generate_stylesheet();return this};d.recalculate_faux_grid=function(){var a=this.$wrapper.width();this.baseX=(f(window).width()-a)/2;this.baseY=
this.$wrapper.offset().top;f.each(this.faux_grid,f.proxy(function(a,c){this.faux_grid[a]=c.update({left:this.baseX+(c.data.col-1)*this.min_widget_width,top:this.baseY+(c.data.row-1)*this.min_widget_height})},this));return this};d.get_widgets_from_DOM=function(){var a=this.$widgets.map(f.proxy(function(a,c){var e=f(c);return this.dom_to_coords(e)},this)),a=l.sort_by_row_and_col_asc(a);f(a).map(f.proxy(function(a,c){return this.register_widget(c)||null},this)).length&&this.$el.trigger("gridster:positionschanged");
return this};d.generate_grid_and_stylesheet=function(){var a=this.$wrapper.width(),b=this.options.max_cols,c=Math.floor(a/this.min_widget_width)+this.options.extra_cols,e=this.$widgets.map(function(){return f(this).attr("data-col")}).get();e.length||(e=[0]);e=Math.max.apply(Math,e);this.cols=Math.max(e,c,this.options.min_cols);Infinity!==b&&b>=e&&b<this.cols&&(this.cols=b);var d=this.options.extra_rows;this.$widgets.each(function(a,b){d+=+f(b).attr("data-sizey")});this.rows=Math.max(d,this.options.min_rows);
this.baseX=(f(window).width()-a)/2;this.baseY=this.$wrapper.offset().top;this.options.autogenerate_stylesheet&&this.generate_stylesheet();return this.generate_faux_grid(this.rows,this.cols)};d.resize_widget_dimensions=function(a){a.widget_margins&&(this.options.widget_margins=a.widget_margins);a.widget_base_dimensions&&(this.options.widget_base_dimensions=a.widget_base_dimensions);this.min_widget_width=2*this.options.widget_margins[0]+this.options.widget_base_dimensions[0];this.min_widget_height=
2*this.options.widget_margins[1]+this.options.widget_base_dimensions[1];this.$widgets.each(f.proxy(function(a,c){var d=f(c),l=d.data();this.resize_widget(d,l.sizex,l.sizey)},this));this.generate_grid_and_stylesheet();this.get_widgets_from_DOM();this.set_dom_grid_height();return!0};d.destroy=function(a){this.$el.removeData("gridster");f(window).unbind(".gridster");this.drag_api&&this.drag_api.destroy();this.remove_style_tags();a&&this.$el.remove();return this};f.fn.gridster=function(a){return this.each(function(){f(this).data("gridster")||
f(this).data("gridster",new l(this,a))})};return l});