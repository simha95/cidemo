Project.modules.importcsv={init:function(){this.initEvents();this.validateAdd()},validateAdd:function(){$("#frmimportcsvadd").validate({ignore:".ignore-hidden",rules:{upload_module:{required:!0},upload_csv:{required:!0},upload_sheet:{required:!0},web_data_url:{required:!0}},messages:{upload_module:{required:"Please select module name."},upload_csv:{required:"Please upload data file."},upload_sheet:{required:"Please select data sheet."},web_data_url:{required:"Please enter data url."}},errorPlacement:function(a,
b){a.appendTo("#"+b.attr("name")+"Err")}})},validateImport:function(){$("#frmimportcsvread").validate({ignore:".ignore-hidden",rules:{"map_column[]":{notRepeatedVariable:!0}},messages:{"map_column[]":{notRepeatedVariable:"Please map different column names"}},errorPlacement:function(a,b){"map_column[]"==b.attr("name")&&$("#import_error_msg").html(a)}})},initEvents:function(){$("#upload_module").change(function(){var a=$(this).val();-1!=$.inArray(a,$import_media_modules)?$("#media_files_upload").slideDown("slow"):
$("#media_files_upload").slideUp("slow");$("#sample_zip_file").attr("href",$import_media_sample_url+"?upload_module="+a)});$("input[name='upload_location']").click(function(){var a=$("input[name='upload_location']:checked").val();$("#columns_separate_setting").addClass("hide-settings");$("#text_delimiter_setting").addClass("hide-settings");"cloud"==a?($(".local-drive-block").hide(),$(".google-drive-block").show(),$(".web-url-block").hide(),$("#upload_csv").addClass("ignore-hidden"),$("#upload_sheet").removeClass("ignore-hidden"),
$("#web_data_url").addClass("ignore-hidden")):"web"==a?($(".local-drive-block").hide(),$(".google-drive-block").hide(),$(".web-url-block").show(),$("#upload_csv").addClass("ignore-hidden"),$("#upload_sheet").addClass("ignore-hidden"),$("#web_data_url").removeClass("ignore-hidden"),"csv"==$("input[name='response_format']:checked").val()&&($("#columns_separate_setting").removeClass("hide-settings"),$("#text_delimiter_setting").removeClass("hide-settings"))):($(".local-drive-block").show(),$(".google-drive-block").hide(),
$(".web-url-block").hide(),$("#upload_csv").removeClass("ignore-hidden"),$("#upload_sheet").addClass("ignore-hidden"),$("#web_data_url").addClass("ignore-hidden"))});$("#pick_google_sheet").click(function(){openAjaxURLFancyBox($import_gdrive_manage_url,{width:"85%",height:"85%",padding:10})});$(".action-more-settings").click(function(){$("#action_settings_anchor").hasClass("active")?($(".toggle-more-settings").removeClass("show-settings"),$("#action_settings_anchor").removeClass("active").attr("title",
js_lang_label.GENERIC_MORE_SETTINGS).html(js_lang_label.GENERIC_MORE_SETTINGS),$("#action_settings_span").removeClass("cut-icon-minus-2").addClass("cut-icon-plus-2")):($(".toggle-more-settings").addClass("show-settings"),$("#action_settings_anchor").addClass("active").attr("title",js_lang_label.GENERIC_LESS_SETTINGS).html(js_lang_label.GENERIC_LESS_SETTINGS),$("#action_settings_span").addClass("cut-icon-minus-2").removeClass("cut-icon-plus-2"))});$("#uploadify_upload_csv").fileupload({url:$import_upload_url,
name:"upload_csv",temp:"temp_upload_csv",paramName:"Filedata",maxFileSize:$import_valid_size,acceptFileTypes:$import_valid_ext,formData:{mode:"add"},add:function(a,b){var c=[],e=$(this).fileupload("option","name"),d=$(this).fileupload("option","temp"),k=$(this).fileupload("option","formData"),m=$(this).fileupload("option","maxFileSize"),f=$(this).fileupload("option","acceptFileTypes"),g=b.originalFiles[0].name,l=b.originalFiles[0].size;$("#columns_separate_setting").addClass("hide-settings");$("#text_delimiter_setting").addClass("hide-settings");
$("#upload_sheets_event").hide();if("*"!=f){var h=g?g.substr(g.lastIndexOf(".")):"",f=new RegExp("(.|/)("+f+")$","i");h&&!f.test(h)&&c.push(js_lang_label.ACTION_FILE_TYPE_IS_NOT_ACCEPTABLE);h&&".csv"==h.toLowerCase()&&($("#columns_separate_setting").removeClass("hide-settings"),$("#text_delimiter_setting").removeClass("hide-settings"))}l&&l>1E3*m&&c.push(js_lang_label.ACTION_FILE_SIZE_IS_TOO_LARGE);0<c.length?Project.setMessage(c.join("\n"),0):($("#practive_"+e).css("width","0%"),$("#progress_"+e).show(),
k.oldFile=$("#"+d).val(),$(this).fileupload("option","formData",k),$("#preview_"+e).html(g),b.submit())},done:function(a,b){if(b&&b.result){var c=$(this).fileupload("option","name"),e=$(this).fileupload("option","temp"),d=$.parseJSON(b.result);"0"==d.success?Project.setMessage(d.message,0):($("#"+c).val(d.uploadfile),$("#"+e).val(d.oldfile),displaySettingOntheFlyImage(c,d),setTimeout(function(){$("#progress_"+c).hide()},1E3),"1"==d.is_multiple&&d.sheets_html&&($("#upload_sheets_html").html(d.sheets_html),
$("#upload_sheets_event").show().click(),Project.modules.importcsv.initUploadData()))}},fail:function(a,b){$.each(b.messages,function(a,b){Project.setMessage(b,0)})},progressall:function(a,b){var c=$(this).fileupload("option","name"),e=parseInt(b.loaded/b.total*100,10);$("#practive_"+c).css("width",e+"%")}});$("#uploadify_upload_media").fileupload({url:$import_media_url,name:"upload_media",temp:"temp_upload_media",paramName:"Filedata",maxFileSize:$import_media_size,acceptFileTypes:$import_media_ext,
formData:{mode:"add"},add:function(a,b){var c=[],e=$(this).fileupload("option","name"),d=$(this).fileupload("option","temp"),k=$(this).fileupload("option","formData"),m=$(this).fileupload("option","maxFileSize"),f=$(this).fileupload("option","acceptFileTypes"),g=b.originalFiles[0].name,l=b.originalFiles[0].size;if("*"!=f){var h=g?g.substr(g.lastIndexOf(".")):"",f=new RegExp("(.|/)("+f+")$","i");h&&!f.test(h)&&c.push(js_lang_label.ACTION_FILE_TYPE_IS_NOT_ACCEPTABLE)}l&&l>1E3*m&&c.push(js_lang_label.ACTION_FILE_SIZE_IS_TOO_LARGE);
0<c.length?Project.setMessage(c.join("\n"),0):($("#practive_"+e).css("width","0%"),$("#progress_"+e).show(),k.oldFile=$("#"+d).val(),$(this).fileupload("option","formData",k),$("#preview_"+e).html(g),b.submit())},done:function(a,b){if(b&&b.result){var c=$(this).fileupload("option","name"),e=$(this).fileupload("option","temp"),d=$.parseJSON(b.result);"0"==d.success?Project.setMessage(d.message,0):($("#"+c).val(d.uploadfile),$("#"+e).val(d.oldfile),displaySettingOntheFlyImage(c,d),setTimeout(function(){$("#progress_"+
c).hide()},1E3))}},fail:function(a,b){$.each(b.messages,function(a,b){Project.setMessage(b,0)})},progressall:function(a,b){var c=$(this).fileupload("option","name"),e=parseInt(b.loaded/b.total*100,10);$("#practive_"+c).css("width",e+"%")}});$("#upload_sheets_event").fancybox({href:"#upload_sheets_html",type:"inline",autoScale:!1,openEffect:"elastic",closeEffect:"elastic",width:"75%",height:"75%",padding:5});Project.modules.importcsv.initJsonView()},validlist:function(){$(".validation_info").click(function(a){a=
$import_valid_url+"&module_name="+$("#import_module_name").val()+"&type="+$(this).attr("aria-type");openAjaxURLFancyBox(a,{width:"85%",height:"85%",padding:10})})},getValidateAddCSV:function(){if($("#frmimportcsvadd").valid()){$("#import_error_msg").html("");var a={url:$import_read_url,beforeSubmit:showAdminAjaxRequest,success:function(a,c,e,d){Project.hide_adaxloading_div();$("#importcsv").html(a);initializeBasicAjaxEvents();Project.modules.importcsv.validateImport();Project.modules.importcsv.initImportReadPage();
Project.modules.importcsv.validlist()}};$("#frmimportcsvadd").ajaxSubmit(a)}return!1},getValidateImportCSV:function(){if(!$("input[name^=skip_column]:checked").length)return alert("Please check atleast one column."),!1;if($("#frmimportcsvread").valid()){$("#ajax_content_div").addClass("ajaxstate");var a={url:$import_process_url,beforeSubmit:showAdminAjaxRequest,success:function(a,c,e,d){$("#ajax_content_div").removeClass("ajaxstate");Project.hide_adaxloading_div();$("#importcsv").html(a);Project.modules.importcsv.initImportProcessPage()}};
$("#frmimportcsvread").ajaxSubmit(a)}return!1},getValidateProcessCSV:function(a){if(confirm("Are you sure want to perform these changes?")){Project.show_adaxloading_div();$("#ajax_content_div").addClass("ajaxstate");var b,c=0,e=$("#media_count").val(),d=$("#media_event").val();a={url:$import_process_url+"?save_type="+a,beforeSubmit:showAdminAjaxRequest,success:function(a,d,f,g){$("#ajax_content_div").removeClass("ajaxstate");Project.hide_adaxloading_div();a=$.parseJSON(a);e&&0!=c||($.isPlainObject(b)&&
b.close(),Project.modules.importcsv.loadFinishPage(a))}};$("#frmimportcsvprocess").ajaxSubmit(a);0<e&&(b=new EventSource($import_media_event_url+"?media_event="+d),b.onmessage=function(a){""!=a.data&&(a=$.parseJSON(a.data),"1"==a.success&&(Project.hide_adaxloading_div(),a=a.content,c=1,b.close(),Project.modules.importcsv.loadFinishPage(a)))})}return!1},loadFinishPage:function(a){var b=1;"0"==a.success&&(b=0);Project.setMessage(a.message,b);a.red_url&&""!=a.red_url?window.location.hash=a.red_url:loadCSVImportPage()},
initUploadData:function(){$(".select-sheet-data").click(function(){Project.show_adaxloading_div();var a=$(this).closest("th").find("input[name='sheetId']"),a=(a=$(a).attr("id"))?a.split("_"):[];$(this).hasClass("expand")?($("#sheet_block_"+a[1]).hide(),$(this).addClass("collapse").removeClass("expand").addClass("maximize").removeClass("minimize")):$(this).hasClass("collapse")&&($("#sheet_block_"+a[1]).show(),$(this).addClass("expand").removeClass("collapse").addClass("minimize").removeClass("maximize"));
Project.hide_adaxloading_div()});$("#select_btn").click(function(){var a=$("input[name='sheetId']:checked").val();if(""==$.trim($("input[name='sheetId']:checked").val()))return alert("Please select any sheet."),!1;$("#upload_index").val(a);$.fancybox.close()})},initImportReadPage:function(){$("input[name^='skip_column']").click(function(){var a=$(this).closest(".import-column-width").index(),b=$(this).is(":checked")?!1:!0;1==b?$(this).closest(".import-column-width").find(".import-map-column").addClass("column-disable"):
$(this).closest(".import-column-width").find(".import-map-column").removeClass("column-disable");$(".import-data-container").find("tr").each(function(){1==b?$(this).find(".import-column-width").eq(a).addClass("column-disable"):$(this).find(".import-column-width").eq(a).removeClass("column-disable")})});$("#import_scroll_vertical").scroll(function(){$("#import_scroll_horizontal").scrollLeft($("#import_scroll_vertical").scrollLeft())})},initImportProcessPage:function(){$("#import_info_success").click(function(){var a=
{type:"success",inserted:$("#track_inserted").val(),updated:$("#track_updated").val()};initImportInfoHelper($("#import_info_success"),a)});$("#import_info_failed").click(function(){var a={type:"failed",failed:$("#track_failed").val()};initImportInfoHelper($("#import_info_failed"),a)});$("#import_info_duplicate").click(function(){var a={type:"duplicate",duplicate:$("#track_duplicate").val()};initImportInfoHelper($("#import_info_duplicate"),a)});$("#import_info_skipped").click(function(){var a={type:"skipped",
valid:$("#track_valid").val(),lookup:$("#track_lookup").val()};initImportInfoHelper($("#import_info_skipped"),a)})},initDriveJSEvents:function(){$("#drive_auth_config").click(function(){$("#drive_config_containter").show();$("#drive_config_help").show();$("#drive_auth_help").hide()});$("#dropbox_auth_config").click(function(){$("#dropbox_config_containter").show();$("#dropbox_config_help").show();$("#dropbox_auth_help").hide()});$("#save_drive_config").click(function(){Project.show_adaxloading_div();
$.ajax({type:"POST",url:$import_gdrive_config_url,data:{type:"gdrive",client_id:$("#gdrive_client_id").val(),client_secret:$("#gdrive_client_secret").val()},success:function(a){Project.hide_adaxloading_div();a=$.parseJSON(a);0==a.success?alert(a.message):($("#drive_config_containter").hide(),$("#drive_config_help").hide(),$("#drive_auth_help").show(),$("#drive_auth_span").show())}})});$("#save_dropbox_config").click(function(){Project.show_adaxloading_div();$.ajax({type:"POST",url:$import_gdrive_config_url,
data:{type:"dropbox",client_id:$("#dropbox_client_id").val(),client_secret:$("#dropbox_client_secret").val()},success:function(a){Project.hide_adaxloading_div();a=$.parseJSON(a);0==a.success?alert(a.message):($("#dropbox_config_containter").hide(),$("#dropbox_config_help").hide(),$("#dropbox_auth_help").show(),$("#dropbox_auth_span").show())}})});$("#discard_drive_config").click(function(){$("#drive_config_containter").hide()});$("#discard_dropbox_config").click(function(){$("#dropbox_config_containter").hide()});
$(".dlp-links a").click(function(a){a.preventDefault();$(".dlp-links").removeClass("active");$(this).parent().addClass("active");a=$(this).attr("onitem");$(".drp-auth-block").hide();$(".drp-content-area").hide();$(".drp-change-area").hide();"Yes"==$("input[name='tokenEnable']").val()&&$("input[name='apiTypeHide']").val()==a?($(".drp-change-area[onitem='"+a+"']").show(),$(".drp-content-area[onitem='"+a+"']").show()):$(".drp-auth-block[onitem='"+a+"']").show()});$("#drive_auth_btn").click(function(){window.open($import_gdrive_auth_url+
"?_nA=1","_blank","width=1000, height=600, location=no, menubar=no, resizable=no, scrollbars=no, top=100, left=100")});$("#dropbox_auth_btn").click(function(){window.open($import_dropbox_auth_url+"?_nA=1","_blank","width=1000, height=600, location=no, menubar=no, resizable=no, scrollbars=no, top=100, left=100")});$(".drp-change-user").click(function(){var a=$(this).parent().attr("onitem");$(".drp-auth-block[onitem='"+a+"']").show();$(".drp-change-area[onitem='"+a+"']").hide();$(".drp-content-area[onitem='"+
a+"']").hide()})},initGDrive:function(){$(".dlp-links.active a").length&&"gdrive"==$(".dlp-links.active a").attr("onitem")&&("Yes"==$("input[name='tokenEnable']").val()?setTimeout(function(){Project.modules.importcsv.getGDriveData({type:"docs"})},500):($(".drp-auth-block[onitem='gdrive']").show(),$(".dlp-links.active a").trigger("click")))},initGdriveJSEvents:function(){$("#gd_next_btn").click(function(a){a=$.trim($("input[name='docId']:checked").val());var b=$("input[name='docId']:checked").attr("id");
if(""==a)return alert("Please select any document."),!1;Project.modules.importcsv.getGDriveData({type:"sheets",docId:a,docName:$("label[for='"+b+"']").text()})})},getGDriveData:function(a){Project.show_adaxloading_div();$.ajax({type:"POST",url:$import_gdrive_data_url,data:a,success:function(b){Project.hide_adaxloading_div();$(".dlp-links.active a").trigger("click");$(".drp-auth-block[onitem='gdrive']").hide();$("div.drp-change-area[onitem='gdrive']").show();$("div.drp-content-area[onitem='gdrive']").show();
$(".drp-content-area[onitem='gdrive'] .drp-content-block").html(b);"sheets"==a.type?Project.modules.importcsv.initSheetData():Project.modules.importcsv.initGdriveJSEvents()}})},initSheetData:function(){$(".fetch-sheet-data").click(function(){Project.show_adaxloading_div();var a=$(this).closest("th").find("input[name='sheetId']"),a=(a=$(a).attr("id"))?a.split("_"):[];$(this).hasClass("expand")?($("#gd_sheet_block_"+a[1]).hide(),$(this).addClass("collapse").removeClass("expand").addClass("maximize").removeClass("minimize")):
$(this).hasClass("collapse")&&($("#gd_sheet_block_"+a[1]).show(),$(this).addClass("expand").removeClass("collapse").addClass("minimize").removeClass("maximize"));Project.hide_adaxloading_div()});$("#gd_submit_btn").click(function(){var a=$("input[name='sheetId']:checked").val();if(""==$.trim($("input[name='sheetId']:checked").val()))return alert("Please select any sheet."),!1;var b=$("input[name='docId']").val(),c=$("input[name='docFile']").val();Project.show_adaxloading_div();$.ajax({type:"POST",
url:$import_gdrive_save_url,data:{sheetId:a,docId:b,docFile:c},success:function(a){Project.hide_adaxloading_div();a=$.parseJSON(a);0==a.success?alert(a.message):(parent.$("#upload_sheet").val(a.file_name),$.fancybox.close())}})});$("#gd_back_btn").click(function(){Project.modules.importcsv.getGDriveData({type:"docs"})})},initJsonView:function(){$("#web_data_url_browse").show();$("input[name='response_format']").click(function(){"csv"==$("input[name='response_format']:checked").val()?($("#first_row_setting").removeClass("hide-settings"),
$("#columns_separate_setting").removeClass("hide-settings"),$("#text_delimiter_setting").removeClass("hide-settings")):($("#first_row_setting").addClass("hide-settings"),$("#import_first_row").val("Yes"),$("#columns_separate_setting").addClass("hide-settings"),$("#text_delimiter_setting").addClass("hide-settings"))});$("#btn_pick_json_xml").click(function(){var a=$("input[name='responsekeyvalue']:checked").val();""!=$.trim(a)?($("#web_data_url_keypath").val(a),parent.$.fancybox.close()):alert("Please select any array value.")});
$("#web_data_url_browse").click(function(){var a=$("#web_data_url").val(),b=$("input[name='response_format']:checked").val();if(""==a)return alert("Please enter web url"),!1;if(-1==$.inArray(b,["json","xml"]))return alert("Selection will available for JSON or XML only."),!1;Project.show_adaxloading_div();if(""==$.trim(a))return jqueryUIalertBox("Please enter data url."),Project.hide_adaxloading_div(),!1;$.ajax({type:"POST",url:$import_web_data_url,dataType:"json",data:{web_url:a,url_type:b},success:function(a){Project.hide_adaxloading_div();
if(""==$.trim(a))return jqueryUIalertBox("Something went wrong. Please enter proper data."),!1;$("#web_url_pick_item").jsonEditor(a,{viewOnly:!0,arrayLimit:4});$.fancybox.open({type:"inline",href:"#web_url_response_block",width:"70%",height:"70%",autoSize:!1})}})})},initDropbox:function(){$(".dlp-links.active a").length&&"dropbox"==$(".dlp-links.active a").attr("onitem")&&("Yes"==$("input[name='tokenEnable']").val()?setTimeout(function(){Project.modules.importcsv.getDropboxData({type:"files"})},500):
($(".drp-auth-block[onitem='dropbox']").show(),$(".dlp-links.active a").trigger("click")))},initDropboxJSEvents:function(){$("input[name='fileId']").click(function(){$("input[name='fileRev']").val($(this).attr("arev"))});$("#dbx_next_btn").click(function(){var a=$("input[name='fileId']:checked").val();if(""==$.trim(a))return alert("Please select any file."),!1;Project.modules.importcsv.getDropboxData({type:"content",fileId:a,fileRev:$("input[name='fileRev']").val()})})},getDropboxData:function(a){Project.show_adaxloading_div();
$.ajax({type:"POST",url:$import_dropbox_data_url,data:a,success:function(b){Project.hide_adaxloading_div();$(".dlp-links.active a").trigger("click");$(".drp-auth-block[onitem='dropbox']").hide();$("div.drp-change-area[onitem='dropbox']").show();$("div.drp-content-area[onitem='dropbox']").show();$(".drp-content-area[onitem='dropbox'] .drp-content-block").html(b);"content"==a.type?Project.modules.importcsv.initDropboxContentEvents():Project.modules.importcsv.initDropboxJSEvents()}})},initDropboxContentEvents:function(){$(".fetch-sheet-data").click(function(){Project.show_adaxloading_div();
var a=$(this).closest("th").find("input[name='fileTabId']"),a=(a=$(a).attr("id"))?a.split("_"):[];$(this).hasClass("expand")?($("#gd_sheet_block_"+a[1]).hide(),$(this).addClass("collapse").removeClass("expand").addClass("maximize").removeClass("minimize")):$(this).hasClass("collapse")&&($("#gd_sheet_block_"+a[1]).show(),$(this).addClass("expand").removeClass("collapse").addClass("minimize").removeClass("maximize"));Project.hide_adaxloading_div()});$("#dbx_submit_btn").click(function(){var a=$("input[name='fileTabId']:checked").val();
if(""==$.trim(a))return alert("Please select any sheet."),!1;var b=$("input[name='docFile']").val();Project.show_adaxloading_div();$.ajax({type:"POST",url:$import_dropbox_save_url,data:{fileTabId:a,docFile:b},success:function(a){Project.hide_adaxloading_div();a=$.parseJSON(a);0==a.success?alert(a.message):(parent.$("#upload_sheet").val(a.file_name),$.fancybox.close())}})});$("#dbx_back_btn").click(function(){Project.modules.importcsv.getDropboxData({type:"files"})})},setDriveHiddenParams:function(a){$("input[name='apiTypeHide']").val(a);
$("input[name='tokenEnable']").val("Yes")}};function loadCSVImportPage(){var a=(new Date).getTime();window.location.hash="tools/import/index|tLoadFP|"+a}function loadImportHistoryPage(){openAjaxURLFancyBox($import_histroy_url,{width:"75%",height:"75%",padding:10});return!1}
function initImportInfoHelper(a,b){b.module_name=$("#import_module_name").val();$.fancybox.open({href:$import_info_url+"&iframe=true",type:"ajax",autoScale:!1,openEffect:"elastic",closeEffect:"elastic",width:"80%",height:"80%",padding:5,beforeLoad:function(){this.ajax.type="POST";this.ajax.data=b}});return!1}
jQuery.validator.addMethod("notRepeatedVariable",function(a,b){var c=[],e=1,d=!0;if($(b).hasClass("column-disable"))return!0;$('select[id^="map_column"]').not(".column-disable").each(function(){var a=$(this).val();if("-1"==jQuery.inArray(a,c))c[e]=a,e++;else return d=!1});return d},"");