$(function(){$(document).on("blur","[name^='system_email_variable']",function(b){Project.modules.systememails.addAutoOptions()})});
Project.modules.systememails={init:function(){this.initEvents();this.validate();this.CCEvents();this.sortRowsFunction()},validate:function(){$("#frmaddupdate").validate({rules:{mse_email_code:{required:!0},mse_email_title:{required:!0},mse_email_subject:{required:!0},mse_from_email:{email:!0},"system_email_variable[]":{required:!0,notRepeatedVariable:!0,defaultSYSVariable:!0},"system_email_description[]":{required:!0}},messages:{mse_email_code:{required:js_lang_label.GENERIC_PLEASE_ENTER_EMAIL_CODE},
mse_email_title:{required:js_lang_label.GENERIC_PLEASE_ENTER_EMAIL_TITLE},mse_email_subject:{required:js_lang_label.GENERIC_PLEASE_ENTER_EMAIL_SUBJECT},mse_from_email:{email:js_lang_label.GENERIC_PLEASE_ENTER_VALID_EMAIL},"system_email_variable[]":{required:js_lang_label.GENERIC_PLEASE_ENTER_VARIABLE,notRepeatedVariable:js_lang_label.GENERIC_PLEASE_ENTER_DIFFERENT_VARIABLE,
defaultSYSVariable:js_lang_label.GENERIC_SYSTEM_VARIABLE_NOT_ALLOWED},"system_email_description[]":{required:js_lang_label.GENERIC_PLEASE_ENTER_DESCRIPTION}},errorPlacement:function(b,a){"mse_email_code"==a.attr("name")&&b.appendTo("#mse_email_codeErr");"mse_email_title"==a.attr("name")&&b.appendTo("#mse_email_titleErr");"mse_email_subject"==a.attr("name")&&b.appendTo("#mse_email_subjectErr");"mse_from_name"==a.attr("name")&&b.appendTo("#mse_from_nameErr");"mse_from_email"==a.attr("name")&&b.appendTo("#mse_from_emailErr");
if("system_email_variable[]"==a.attr("name")){var c=a.attr("id");b.appendTo("#"+c+"Err")}"system_email_description[]"==a.attr("name")&&(c=a.attr("id"),b.appendTo("#"+c+"Err"))},submitHandler:function(b){b={beforeSubmit:showAdminAjaxRequest,success:function(a,b,d,e){a=$.parseJSON(a);responseAjaxDataSubmission(a);if("0"==a.success)return!1;loadAdminAddUpdateControl(a)}};$("#frmaddupdate").ajaxSubmit(b);return!1}})},initEvents:function(b){b=tinymce_editor_tollbar;var a=tinymce_editor_plugins;a[3]+=" mention";
tinyMCE.baseURL=el_tpl_settings.editor_js_url;$("#mse_email_message").tinymce({script_url:el_tpl_settings.editor_js_url+"tinymce.min.js",content_css:el_tpl_settings.editor_css_url+"style.css",plugins:a,toolbar:b,templates:tinymce_editor_templates,theme:"modern",resize:"both",skin:"light",image_advtab:!0,relative_urls:!1,remove_script_host:!1,external_filemanager_path:site_url+"filemanager/",filemanager_title:"Filemanager",external_plugins:{filemanager:el_tpl_settings.js_libraries_url+"filemanager/plugin.min.js"},
mentions:{source:[],delimiter:"#",insert:function(a){return"#"+a.name+"#"}},setup:function(a){a.on("change",function(a){tinyMCE.triggerSave()});a.on("click",function(b){tinyMCE.get(a.id).focus()})},init_instance_callback:function(a){Project.modules.systememails.addAutoOptions()}})},getSystemEmailVariableTable:function(){$.post(admin_url+cus_enc_url_json.systememail_variables,{row_id:inc_no,dis_no:dis_no},function(b){$("#mails_fields_list").append(b);initializeTooltipsEvents();inc_no++;dis_no++})},
deleteSystemEmailVariableRow:function(b){$("<div></div>").html(js_lang_label.GENERIC_ARE_YOU_SURE_TO_DELETE_THIS_VARIABLE).dialog({title:js_lang_label.GENERIC_DELETE_VARIABLE,autoOpen:!0,bgiframe:!0,buttons:[{text:js_lang_label.GENERIC_OK,click:function(){$("#tr_child_row_"+b).remove();var a=1;dis_no--;$(".row-num-child").each(function(){$(this).html(a);a++});Project.modules.systememails.addAutoOptions();$(this).remove()}},{text:js_lang_label.GENERIC_CANCEL,click:function(){$(this).remove()}}],modal:!0})},
sortRowsFunction:function(){var b=["td-dark","td-light"];$("#mails_fields_list").sortable({items:".field-sortable",containment:"parent",cursor:"move",forcePlaceholderSize:!0,placeholder:"ajax-sortable-placeholder",start:function(a,b){$(b.item).css({"background-color":"#009DDB"});$("parent").css("position","absolute")},stop:function(a,c){$(c.item).css({"background-color":""});$("parent").css("position","relative");var d=1;$(".field-sortable").each(function(a){a%=2;var c=0==a?1:0;$(this).find("tr.color-chnage").removeClass(b[c]).addClass(b[a]);
$(this).find("td.row-num-child").html(d);d++})}})},addAutoOptions:function(){var b=[];$("[name^='system_email_variable']").each(function(){var a=$.trim($(this).val());a&&((a=a.toString())&&"#"==a.substring(0,1)&&(a=a.toString().substr(1)),a&&"#"==a.substring(a.length-1)&&(a=a.toString().substr(0,a.length-1)));a&&b.push({name:a})});tinyMCE.get("mse_email_message").settings.mentions.source=b},CCEvents:function(){}};Project.modules.systememails.init();
jQuery.validator.addMethod("notRepeatedVariable",function(b,a){var c=[],d=!0;$('input[id^="system_email_variable"]').each(function(){var a=$(this).val();if("-1"==jQuery.inArray(b,c))c.push(a),d=!0;else if(a==b)return d=!1});return d},"");jQuery.validator.addMethod("defaultSYSVariable",function(b,a){return"-1"!=jQuery.inArray(b,"#vEmail# #vSubject# #vFromName# #vFromEmail# #vCCEmail# #vBCCEmail#".split(" "))?!1:!0},"");